COMMENT -----------------------------------------------------------------------
  Test 05: Arrays
  
  Tests:
  - One-dimensional arrays
  - Array bounds (non-zero lower bound)
  - Array element access and assignment
  - Arrays as procedure parameters
  - Multi-dimensional arrays
  - Dynamic array bounds
-----------------------------------------------------------------------;

BEGIN
    INTEGER i, j, sum;
    REAL rsum;
    
    COMMENT --- Simple integer array ---;
    INTEGER ARRAY a[1:10];
    
    FOR i := 1 STEP 1 UNTIL 10 DO
        a[i] := i * 2;
    
    IF a[1] <> 2 THEN error("Array element 1 failed");
    IF a[5] <> 10 THEN error("Array element 5 failed");
    IF a[10] <> 20 THEN error("Array element 10 failed");
    
    COMMENT --- Sum array elements ---;
    sum := 0;
    FOR i := 1 STEP 1 UNTIL 10 DO
        sum := sum + a[i];
    IF sum <> 110 THEN error("Array sum failed");
    
    COMMENT --- Array with non-zero lower bound ---;
    INTEGER ARRAY b[-5:5];
    
    FOR i := -5 STEP 1 UNTIL 5 DO
        b[i] := i;
    
    IF b[-5] <> -5 THEN error("Negative index access failed");
    IF b[0] <> 0 THEN error("Zero index access failed");
    IF b[5] <> 5 THEN error("Positive index access failed");
    
    sum := 0;
    FOR i := -5 STEP 1 UNTIL 5 DO
        sum := sum + b[i];
    IF sum <> 0 THEN error("Array with negative bounds sum failed");
    
    COMMENT --- Real array ---;
    REAL ARRAY r[1:5];
    
    FOR i := 1 STEP 1 UNTIL 5 DO
        r[i] := i * 1.5;
    
    rsum := 0.0;
    FOR i := 1 STEP 1 UNTIL 5 DO
        rsum := rsum + r[i];
    IF rsum < 22.4 OR rsum > 22.6 THEN error("Real array sum failed");
    
    COMMENT --- Boolean array ---;
    BOOLEAN ARRAY flags[1:4];
    
    flags[1] := TRUE;
    flags[2] := FALSE;
    flags[3] := TRUE;
    flags[4] := FALSE;
    
    IF NOT flags[1] THEN error("Boolean array element 1 failed");
    IF flags[2] THEN error("Boolean array element 2 failed");
    
    COMMENT --- Procedure with array parameter ---;
    INTEGER PROCEDURE arraySum(arr, lo, hi); 
        INTEGER ARRAY arr; INTEGER lo, hi;
    BEGIN
        INTEGER i, s;
        s := 0;
        FOR i := lo STEP 1 UNTIL hi DO
            s := s + arr[i];
        arraySum := s;
    END;
    
    sum := arraySum(a, 1, 10);
    IF sum <> 110 THEN error("Array parameter sum failed");
    
    sum := arraySum(a, 1, 5);
    IF sum <> 30 THEN error("Partial array sum failed");
    
    COMMENT --- Procedure that modifies array ---;
    PROCEDURE doubleArray(arr, lo, hi);
        INTEGER ARRAY arr; INTEGER lo, hi;
    BEGIN
        INTEGER i;
        FOR i := lo STEP 1 UNTIL hi DO
            arr[i] := arr[i] * 2;
    END;
    
    INTEGER ARRAY c[1:5];
    FOR i := 1 STEP 1 UNTIL 5 DO
        c[i] := i;
    
    doubleArray(c, 1, 5);
    
    IF c[1] <> 2 THEN error("Array modification element 1 failed");
    IF c[3] <> 6 THEN error("Array modification element 3 failed");
    IF c[5] <> 10 THEN error("Array modification element 5 failed");
    
    COMMENT --- Two-dimensional array ---;
    INTEGER ARRAY matrix[1:3, 1:3];
    
    FOR i := 1 STEP 1 UNTIL 3 DO
        FOR j := 1 STEP 1 UNTIL 3 DO
            matrix[i, j] := i * 10 + j;
    
    IF matrix[1, 1] <> 11 THEN error("Matrix [1,1] failed");
    IF matrix[2, 3] <> 23 THEN error("Matrix [2,3] failed");
    IF matrix[3, 2] <> 32 THEN error("Matrix [3,2] failed");
    
    COMMENT --- Sum of 2D array ---;
    sum := 0;
    FOR i := 1 STEP 1 UNTIL 3 DO
        FOR j := 1 STEP 1 UNTIL 3 DO
            sum := sum + matrix[i, j];
    IF sum <> 198 THEN error("Matrix sum failed");
    
    COMMENT --- Array bounds functions ---;
    IF lowerbound(a, 1) <> 1 THEN error("lowerbound(a,1) failed");
    IF upperbound(a, 1) <> 10 THEN error("upperbound(a,1) failed");
    IF lowerbound(b, 1) <> -5 THEN error("lowerbound(b,1) failed");
    IF upperbound(b, 1) <> 5 THEN error("upperbound(b,1) failed");
    
    COMMENT --- Dynamic array bounds ---;
    INTEGER n;
    n := 5;
    BEGIN
        INTEGER ARRAY dynamic[1:n];
        
        FOR i := 1 STEP 1 UNTIL n DO
            dynamic[i] := i * i;
        
        sum := 0;
        FOR i := 1 STEP 1 UNTIL n DO
            sum := sum + dynamic[i];
        IF sum <> 55 THEN error("Dynamic array sum failed");
    END;
    
    COMMENT --- All tests passed ---;
    outtext("Test 05: Arrays - PASSED");
    outimage;
END
